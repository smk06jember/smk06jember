<meta name='viewport' content='width=device-width, initial-scale=1'/>
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kopi_enem smkn6jember</title>
  <link rel="stylesheet" 
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" 
 crossorigin="anonymous" 
 referrerpolicy="no-referrer" />
 <link rel="stylesheet" href="style.css">
    </style>
</head>
<body>

<header>
    <h1>Kopi_enem smkn6jember</h1>
    <p>Kopi buatan smkn6jember!</p>
</header>

<section class="login-section">
    <h2>Login Admin</h2>
    <input type="password" id="admin-password" placeholder="Password">
    <button onclick="loginAdmin()">Login</button>
    <p id="login-message" class="hidden">Password salah!</p>
</section>

<section class="admin-panel hidden">
    <h2>Panel Admin</h2>

    <h3>Tambah Produk Baru</h3>
    <input type="text" id="new-product-name" placeholder="Nama Produk Baru">
    <input type="text" id="new-product-price" placeholder="Harga Produk Baru">
    <input type="number" id="new-product-rating" placeholder="Rating Produk Baru (1-5)" min="1" max="5">
    <input type="file" id="new-product-image" accept="image/*">
    <button onclick="addProduct()">Tambah Produk</button>

    <h3>Edit/Hapus Produk</h3>
    <select id="existing-product"></select>
    <button onclick="deleteProduct()">Hapus Produk</button>

    <h3>Edit Produk</h3>
    <input type="text" id="edit-product-name" placeholder="Nama Produk">
    <input type="text" id="edit-product-price" placeholder="Harga Produk">
    <input type="number" id="edit-product-rating" placeholder="Rating (1-5)" min="1" max="5">
    <input type="file" id="edit-product-image" accept="image/*">
    <button onclick="editProduct()">Simpan Perubahan</button>
</section>

<section class="products">
    <h2>Menu Kopi</h2>
    <div class="product-list"></div>
</section>

<section class="contact">
    <h2>Hubungi Kami</h2>
    <p>Untuk pemesanan dan pertanyaan, hubungi kami melalui WhatsApp:</p>
    <a href="https://wa.me/6285707275165">
        <i class="fab fa-whatsapp"></i> ORDER DI SINI
    </a>
</section>

<footer>
    <p>&copy; 2025 SMKN 6 JEMBER</p>
</footer>

<script>
/* ===== LOCAL STORAGE SETUP ===== */
function getProducts() {
    return localStorage.getItem('products') ? JSON.parse(localStorage.getItem('products')) : [];
}
function saveProducts(products) {
    localStorage.setItem('products', JSON.stringify(products));
}

/* ===== INITIAL DATA ===== */
if (!localStorage.getItem('products')) {
    const initialProducts = [
        { id: 1, name: 'Cappuccino', price: 'Rp 10.000', rating: 4.5, image:'', comments: [] },
        { id: 2, name: 'Americano', price: 'Rp 9.000', rating: 4.0, image:'', comments: [] },
        { id: 3, name: 'Red Velvet', price: 'Rp -', rating: 3.5, image:'', comments: [] },
        { id: 4, name: 'Karamel Espresso', price: 'Rp -', rating: 4.2, image:'', comments: [] },
        { id: 5, name: 'Kopi Susu', price: 'Rp 10.000', rating: 4.8, image:'', comments: [] },
        { id: 6, name: 'Cappuccino (Panas)', price: 'Rp 8.000', rating: 4.6, image:'', comments: [] },
        { id: 7, name: 'Americano (Panas)', price: 'Rp 8.000', rating: 4.1, image:'', comments: [] },
        { id: 8, name: 'Espresso', price: 'Rp 8.000', rating: 4.3, image:'', comments: [] },
        { id: 9, name: 'Kopi Tubruk', price: 'Rp 5.000', rating: 4.7, image:'', comments: [] },
        { id: 10, name: 'Kopi Susu (Panas)', price: 'Rp 8.000', rating: 4.9, image:'', comments: [] }
    ];
    saveProducts(initialProducts);
}

/* ===== ADMIN LOGIN ===== */
let isAdmin = false;
let selectedProductId = null;

function loginAdmin() {
    const password = document.getElementById('admin-password').value;
    const loginMessage = document.getElementById('login-message');
    const adminPanel = document.querySelector('.admin-panel');
    const loginSection = document.querySelector('.login-section');

    if (password === '12344321') {
        isAdmin = true;
        adminPanel.classList.remove('hidden');
        loginSection.classList.add('hidden');
        loginMessage.classList.add('hidden');
        populateProductOptions();
        renderProducts(); // refresh agar tombol hapus komentar muncul
    } else {
        loginMessage.classList.remove('hidden');
    }
}

/* ===== PRODUCT RENDERING ===== */
function generateRatingStars(rating) {
    let stars = '';
    for (let i = 0; i < Math.floor(rating); i++) stars += '<i class="fas fa-star"></i>';
    if (rating % 1 >= 0.5) stars += '<i class="fas fa-star-half-alt"></i>';
    return stars;
}

function renderProducts() {
    const productList = document.querySelector('.product-list');
    const products = getProducts();
    productList.innerHTML = '';

    products.forEach(product => {
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
            ${product.image ? `<img src="${product.image}" alt="${product.name}" style="max-width:100%; height:auto;">` : ''}
            <h3>${product.name}</h3>
            <p class="price">${product.price}</p>
            <div class="rating">${generateRatingStars(product.rating)}</div>
            <div class="comment-form">
                <input type="text" placeholder="Nama Anda">
                <textarea placeholder="Komentar Anda"></textarea>
                <button onclick="addComment(this, ${product.id})">Kirim</button>
            </div>
            <div class="comments">
                ${product.comments.map((c, idx)=>`
                  <p>
                    <strong>${c.user}:</strong> ${c.text}
                    ${isAdmin ? `<button onclick="deleteComment(${product.id}, ${idx})">Hapus</button>` : ''}
                  </p>
                `).join('')}
            </div>
        `;
        productList.appendChild(div);
    });
}

/* ===== COMMENT FUNCTION ===== */
function addComment(button, productId) {
    const name = button.parentNode.querySelector('input[type="text"]').value;
    const text = button.parentNode.querySelector('textarea').value;
    if(!name || !text) return alert('Nama & komentar harus diisi');

    const products = getProducts();
    const product = products.find(p => p.id === productId);
    if (product) {
        product.comments.push({ user: name, text: text });
        saveProducts(products);
        renderProducts();
    }
}

/* ===== DELETE COMMENT (ADMIN) ===== */
function deleteComment(productId, commentIndex) {
    if (!isAdmin) return alert("Hanya admin yang bisa menghapus komentar!");
    let products = getProducts();
    let product = products.find(p => p.id === productId);
    if (product) {
        product.comments.splice(commentIndex, 1);
        saveProducts(products);
        renderProducts();
    }
}

/* ===== ADMIN PANEL ===== */
function populateProductOptions() {
    const select = document.getElementById('existing-product');
    const products = getProducts();
    select.innerHTML = '';
    products.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        option.textContent = p.name;
        select.appendChild(option);
    });

    select.onchange = () => {
        selectedProductId = parseInt(select.value);
        const product = products.find(p => p.id === selectedProductId);
        if (product) {
            document.getElementById('edit-product-name').value = product.name;
            document.getElementById('edit-product-price').value = product.price;
            document.getElementById('edit-product-rating').value = product.rating;
        }
    };
}

function addProduct() {
    const name = document.getElementById('new-product-name').value;
    const price = document.getElementById('new-product-price').value;
    const rating = parseFloat(document.getElementById('new-product-rating').value);
    const imageInput = document.getElementById('new-product-image');

    if (!name || !price || isNaN(rating) || rating < 1 || rating > 5) {
        return alert('Pastikan semua kolom terisi dengan benar (Rating 1-5)');
    }

    let imageURL = '';
    if (imageInput.files && imageInput.files[0]) {
        imageURL = URL.createObjectURL(imageInput.files[0]);
    }

    const products = getProducts();
    const newId = products.length > 0 ? Math.max(...products.map(p=>p.id))+1 : 1;
    products.push({ id: newId, name, price, rating, image: imageURL, comments: [] });
    saveProducts(products);
    renderProducts();
    populateProductOptions();

    document.getElementById('new-product-name').value='';
    document.getElementById('new-product-price').value='';
    document.getElementById('new-product-rating').value='';
    imageInput.value='';
}

function editProduct() {
    if (!selectedProductId) return alert('Pilih produk dulu');
    const name = document.getElementById('edit-product-name').value;
    const price = document.getElementById('edit-product-price').value;
    const rating = parseFloat(document.getElementById('edit-product-rating').value);
    const imageInput = document.getElementById('edit-product-image');

    if (!name || !price || isNaN(rating) || rating <1 || rating>5) return alert('Pastikan semua kolom terisi dengan benar');

    const products = getProducts();
    const product = products.find(p => p.id === selectedProductId);
    if(product){
        product.name = name;
        product.price = price;
        product.rating = rating;
        if (imageInput.files && imageInput.files[0]) product.image = URL.createObjectURL(imageInput.files[0]);
        saveProducts(products);
        renderProducts();
        populateProductOptions();

        document.getElementById('edit-product-name').value='';
        document.getElementById('edit-product-price').value='';
        document.getElementById('edit-product-rating').value='';
        imageInput.value='';
        selectedProductId=null;
    }
}

function deleteProduct() {
    if (!selectedProductId) return alert('Pilih produk dulu');
    let products = getProducts();
    products = products.filter(p => p.id !== selectedProductId);
    saveProducts(products);
    renderProducts();
    populateProductOptions();
    document.getElementById('edit-product-name').value='';
    document.getElementById('edit-product-price').value='';
    document.getElementById('edit-product-rating').value='';
    selectedProductId = null;
}

/* ===== INITIAL RENDER ===== */
renderProducts();
</script>

</body>
</html>
